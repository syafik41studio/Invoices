<h2>Messages</h2>
<div class="tag_menu">
  <!--<a class="btn_search" href="#"></a>-->
  <input type="text" id="input-search-conversation" name="conversation_id" />
  <%= link_to "+ New Message", new_conversation_path, :class => "btn_newmessage", :id => "create-user", :remote => true %>
  <div style="clear:both"></div>
</div>
<div id="list-messages">
  <% @conversations.each do |conversation| %>
    <div id="conversation-<%= conversation.id %>">
      <%= render "conversation", {:conversation => conversation} %>
    </div>
  <% end %>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    $("#input-search-conversation").tokenInput("/search_conversations_by_name.json", {
      propertyToSearch: "title",
      tokenLimit: 1,
      resultsFormatter: function(item){ return "<li>" + "<img src='/images/photo.png' height='25px' width='25px' />" + "<div style='display: inline-block; padding-left: 10px;'><div class='full_name'>" + item.title + "</div><div class='email'>" + item.last_message + "</div></div></li>" },
      tokenFormatter: function(item) { return "<li><p>" + item.title + "</p></li>" },
      onAdd:function(item){
        $(window.location).attr('href', '/conversations/'+item.id);
      }
    });
    $('.token-input-list').css({"float":"right", "clear":"none","margin-left":"10px"});
    $('.token-input-list').addClass("ui-corner-all");
  });
</script>
